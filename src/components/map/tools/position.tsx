import { Form, Input, InputNumber, Modal } from "antd";
import { useEffect, useState } from "react";
import { useMap } from "react-leaflet";

// 添加坐标跳转按钮
interface Poinsition {
  lat: number;
  lng: number;
}
export default () => {
  const [open, setOpen] = useState(false);
  const [form] = Form.useForm();
  const map = useMap();

  useEffect(() => {
    const toolbar = document.getElementById("toolbar");
    const tool = document.createElement("div");
    tool.title = "坐标定位";
    tool.style.cssText = `width:30px;height:30px;background-color:#fff;display:flex;justify-content:center;align-items:center;z-index:999;;border-bottom:1px solid #ccc;`;
    tool.innerHTML = `<svg
      style="
        width: 50%;
        height: 50%;
      "
      viewBox="0 0 1024 1024"
      version="1.1"
      xmlns="http://www.w3.org/2000/svg"
      width="16"
      height="16"
    >
    <path
      d="M758.039805 427.651708l3.79815 13.293417c0.949674 3.798233 0 17.091782 0 21.839441-8.54546 96.852249-10.444792 159.521481 44.628107 247.827971l26.587016 32.284183c10.444792 11.394433 18.041092 18.990633 28.485833 29.435491 20.890098 18.990766 39.880333 37.031841 64.568498 53.173932l-8.545908 1.899116c-20.889567 13.2934-149.076905 33.233591-176.613114 36.082266-139.581323 15.192533-249.727453-13.293549-416.845267 4.747658-31.334591 3.7981-57.921524 10.444875-86.40749 19.940191-17.091633 5.697067-24.687916 8.545758-37.981382 15.192533-13.293417 6.646775-23.738291 14.242958-39.880349 18.041208 0-19.940341 8.545758-44.628174 13.29345-61.719674 35.132708-138.631881 86.407507-279.162878-23.738321-365.570401-15.19255-11.394433-33.233673-23.738275-42.728984-37.031824l219.342144 16.142224c141.133813 0.836484 170.663973 0.256422 226.938438-2.848675l-10.444891-26.586966-219.342138 0c-122.1702 0-194.654285-18.041208-271.566508-26.586817-41.779461-4.747791-34.183169 12.343842-16.142046 29.435359 50.325228 49.375815 127.237449 84.50854 143.379507 149.076739 20.8897 79.760749-30.385079 221.241304-48.426204 306.699269-30.385049 137.682306-13.293486 81.659849 59.820587 42.728891 190.856188-101.59989 395.005876-3.797951 663.723729-67.416741 48.426241-11.394433 76.912107-13.293417 137.682472-13.293417-4.747857-11.394416 0-5.697216 0-26.586949C920.409993 799.868735 785.576445 690.672362 783.67713 589.072455 770.383912 565.334031 776.08088 430.500399 782.727953 399.165775 780.828637 385.872358 783.67713 391.569442 773.232288 385.872358l-16.14171 44.628041z"
      fill="#18073"
    />
    <path
      d="M650.538473 22.843589c-137.653311-1.423483-240.800248 135.023715-171.973501 268.823592 13.466157 25.621292 144.97236 296.093936 173.400701 313.174897 37.406267-88.250924 116.720094-209.230031 164.599799-318.832081 71.818785-162.267703-56.801217-261.743066-166.026999-263.166408zm4.043651 69.242338c4.28585 0.028215 8.540929 0.222232 12.606604 0.679643 0.076346 0.009543 0.16099-0.009693 0.238165 0 8.044018 0.920464 15.690357 2.767449 22.834607 5.204471 69.170103 23.157196 94.865136 111.380619 57.086634 169.485588-13.88971 21.363093-36.190627 38.659797-68.26612 47.066623-151.120082 39.855288-215.511093-173.623963-65.887437-216.325929 9.830458-2.823182 19.302539-4.566553 28.305425-5.430753 4.499867-0.427536 8.796537-0.706696 13.08237-0.679643z"
      fill="#18074"
    />
    <path
      d="M787.967062 712.990141c-126.805065 56.82354-231.68593 2.848691-326.639195-44.628024-38.930924-19.940175-38.233373-22.694247-106.539027-38.530408 5.697216-22.788717 17.573706-31.658065 19.47279-60.144014 30.022972-5.340848 95.612013-34.260242 145.937253-27.613467 17.0916 1.899133 34.183199 7.59635 56.022573 7.59635l-5.697283-13.293566c-18.9907 0-31.334591-3.798083-52.224341-5.697216-53.106349-5.040179-104.406542 17.091649-143.379506 26.773631 0-16.141942-3.79815-55.259564-8.545825-64.754881-19.922167 3.996167-4.747658 13.293417-4.747658 66.467332-19.940191 0-33.233658-1.899116-48.426191-4.747658-18.99065-3.798233-31.334591-10.444858-44.628074-4.747642 3.79815 8.545742-11.394383 8.545742 40.829974 16.141942 20.889716 2.848675 31.334591 5.697216 52.224291 5.697216-7.59625 94.003707-62.669182 46.527141-128.186989 102.549598-15.1925 13.293417-12.343908 10.444875-14.242991 21.839158-0.473509 1.181201 9.495333-5.697067 23.738358-16.141942 18.041125-12.343991 61.719624-30.385049 86.407474-33.233741-4.747658 21.839308-22.788783 56.022457-20.8897 77.861765 3.798133 31.334624 18.041125 51.274799 20.8897 81.659865l13.293483 0c-0.949508-58.870999-50.325241-60.770116 4.747691-164.269139 54.123374 0 145.278589 56.022325 209.846821 82.609274 83.558749 33.233741 144.32913 43.678615 232.635687-2.848525 5.966518-4.186102-1.899316-8.545908-1.899316-8.545908z"
      fill="#18075"
    />
    </svg>`;
    toolbar?.appendChild(tool);
    tool.onclick = () => {
      setOpen(true);
    };
  }, []);

  const handleOk = () => {
    setOpen(false);
    form
      .validateFields()
      .then((values) => {
        handleFlyto(values);
      })
      .catch((errorInfo) => {
        console.log("Validate Failed:", errorInfo);
      });
  };
  const handleCancel = () => {
    setOpen(false);
  };

  const handleFlyto = (values: Poinsition) => {
    map.setView([values.lat, values.lng], 10);
    setOpen(false);
  };
  return (
    <Modal
      width={300}
      title="坐标定位"
      open={open}
      onOk={handleOk}
      onCancel={handleCancel}
    >
      <Form
        form={form}
        preserve={false}
        labelCol={{ span: 6 }}
        wrapperCol={{ span: 18 }}
        onFinish={handleFlyto}
      >
        <Form.Item label="经度" name="lng" rules={[{ required: true }]}>
          <InputNumber style={{ width: "100%" }} />
        </Form.Item>
        <Form.Item label="纬度" name="lat" rules={[{ required: true }]}>
          <InputNumber style={{ width: "100%" }} />
        </Form.Item>
      </Form>
    </Modal>
  );
};
